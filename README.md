# RabbitMQ Demo

Docker образ с примером взаимодействия сервисов PHP, RabbitMQ и Redis. 
В Redis добавляем товары, а в очередь добавляем данные для обновления этих товаров, 
и затем читаем данные из очереди и актуализируем цену и остатки товаров в Redis БД.

---

## Состав образа

- nginx
- php-fpm
- redis
- rabbitmq
- xdebug
- composer
- predis/predis
- php-amqplib/php-amqplib

---

#### Запуск контейнеров
```bash
cd docker/tools && ./up.sh
```

#### Остановка контейнеров
```bash
cd docker/tools && ./down.sh
```

#### Зайти в контейнер PHP
```bash
cd docker/tools && ./exec.sh
```

---

### Установка зависимостей Composer
```bash
cd docker/tools && ./exec.sh && composer i
```

---

### Использование

- [1] `product_add_redis.php` - скрипт добавления товаров (с хеш ключем который будет ID в БД redis)
- [2] `products.php` - скрипт выводит список товаров из БД redis (запоминаем цену и остаток товаров)
- [3] `producer.php` - скрипт добавления актуальной информации о товарах в очередь (очередь на обновление цен\остатков)
- [4] `consumer.php` или `consumer_console.php` - скрипт считывающий сообщения из очереди и обновляющий информацию в товарах в БД redis
- [5] `products.php` - скрипт выводит список товаров из БД redis (фиксируем что цены и остатки изменились)

* скрипты нужно запускать в указанной последовательности

